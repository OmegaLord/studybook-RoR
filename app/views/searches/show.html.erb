<h1>Search</h1>

<h2>Новый поиск</h2>
<%= form_tag search_path, method: :get do %>
  <%= label_tag :starting %>
    <%= select_tag :starting, options_for_select(station_list) %>
  <%= label_tag :destination %>
  <%= select_tag :destination, options_for_select(station_list) %>
  <%= submit_tag "Search" %>
<% end %>

<% if @data %>
  <h2>Results</h2>
  <% if @data.present? %>
    <table class="table table-striped">
      <thead>
      <tr>
        <th>Route</th>
        <th>Train</th>
        <th>Departure</th>
        <th>Arrival</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <% @data.each do |route, data| %>
      <tr>
        <td><%= route_name(route) %></td>
          <% trains(route).each do |train| %>
            <tr>
              <td></td>
              <td><%= train.number %></td>
              <td><%= data[:departure] %></td>
              <td><%= data[:arrival] %></td>
              <td>
                <%= button_to "Buy", new_ticket_path, method: :get,
                              params:{ ticket: {first_station_id: data[:starting],
                                                last_station_id: data[:destination],
                                                arrival: data[:arrival],
                                                departure: data[:departure],
                                                train_id: train.id } } %>
              </td>
            </tr>
          <% end %>
      </tr>
      <% end %>
      </tbody>
    </table>
  <% else %>
    <p>No routes</p>
  <% end %>
<% end %>
